(function(){function t(){return void 0===n._deviceDataId&&(n._deviceDataId=s.codec.base64.fromBits(s.random.randomWords(6,0)).replace(/[\+\/]/g,"0")),n._deviceDataId}function e(t,e,o){setTimeout(function(){if(!document.getElementById(o)){var n=document.createElement("iframe");n.id=o,n.width=1,n.height=1,n.frameBorder=0,n.scrolling="no",n.src=t,document.body.appendChild(n);var r=document.createElement("img");r.src=e,r.width=1,r.height=1;try{n.appendChild(r)}catch(i){}}},50)}function o(){var o,r="?m="+(OpenPay.sandboxMode?n._sandboxCollectorId:n._collectorId)+"&s="+encodeURIComponent(t());o=OpenPay.developMode?n._developHostname:OpenPay.sandboxMode?n._sandboxHostname:n._hostname;var i=o+n._collectorImg+r,s=o+n._collectorIframe+r;return e(s,i,"_op_data_r"),t()}var n=function(){},r=function(){},i=function(){};n._hostname="https://api.openpay.mx/",n._sandboxHostname="https://sandbox-api.openpay.mx/",n._developHostname="https://dev-api.openpay.mx/",n._collectorIframe="logo.htm",n._collectorImg="logo.gif",n._collectorId=203e3,n._sandboxCollectorId=203e3,n._deviceDataId=void 0,n.setup=function(e,r){var i=t();if(e&&document.getElementById(e)){var s=document.createElement("input");s.setAttribute("type","hidden"),s.value=i,s.name=r?r:"deviceDataId",s.id=r?r:"deviceDataId",document.getElementById(e).appendChild(s)}var a=!0;try{OpenPay.getId(),OpenPay.getApiKey()}catch(c){a=!1}if(a){console.log("executing sift mode");var h,l=OpenPay.getId(),d=OpenPay.getApiKey();h=OpenPay.developMode?n._developHostname:OpenPay.sandboxMode?n._sandboxHostname:n._hostname;var u=h+"v1/"+l+"/antifraudkeys";try{OpenPay.getBeaconKey.beaconKey(u,d,"",i)}catch(c){console.log("continue without beaconkey"+c)}}return o()},i.beaconKey=function(t,e,o,n){function r(t,e,o){clearTimeout(h);var n=null;t=t||"Unknown error",e=e||0,o=o||"{}";try{n=JSON.parse(o)}catch(r){t="Response error"}}function i(){return s(window,"XMLHttpRequest")?new XMLHttpRequest:void 0}function s(t,e){var o=typeof t[e];return"function"==o||!("object"!=o||!t[e])||"unknown"==o}function a(){if("undefined"!=typeof c.readyState&&4==c.readyState||!f)if(clearTimeout(h),c.status<200||c.status>=300)r("Request error NO IE",c.status,c.responseText);else try{var t=c.responseText;t=t.replace("(",""),t=t.replace(")","");var e=JSON.parse(t),i=e.data;console.log("beaconKey ok"),i.length>0?OpenPay.deviceDataSC.setupSC(o,n,i):console.log("Empty beaconKey normal in Sandbox")}catch(s){r("Response error (Unknown final status) NO IE",c.status,"{}")}}var c=null,h=null,l=t,d={},u=0,p=btoa(e+":"),_={};if("undefined"==typeof JSON)return void r("Browser error (JSON library not found)");u=4e4;var f=XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;if(f){if(!(c=i()))return void r("Browser error (CORS not supported)");d={Accept:"application/json","Content-Type":"application/json",Authorization:"Basic "+p},c.open("GET",l,!0),"withCredentials"in c&&(c.withCredentials=!0);for(var y in d)d.hasOwnProperty(y)&&d[y]&&"setRequestHeader"in c&&c.setRequestHeader(y,d[y]);"onreadystatechange"in c?c.onreadystatechange=a:"onload"in c&&"onerror"in c&&(c.onload=a,c.onerror=r),h=setTimeout(function(){"onload"in c?c.onload=Function.prototype:c.onreadystatechange=Function.prototype,c.abort(),c=null,r("Timeout after "+u+" milliseconds")},u),c.send()}else{if("undefined"==typeof XDomainRequest)return void r("Browser error (CORS not supported)");_.apiKey=p;var m=function(t){if(t.error)r("Request error",t.httpStatus,JSON.stringify(t));else try{var e=t.data;console.log("beaconKey ok"),e.length>0?OpenPay.deviceDataSC.setupSC(o,n,e):console.log("Empty beaconKey normal in Sandbox")}catch(i){r("Response error (Unknown final status)",c.status,"{}")}},g={callbackName:"getResultData",onSuccess:m,onError:r,timeout:u,url:l+"/jsonp",data:_};$jsonp.send(g)}},r.setupSC=function(t,e,o){console.log("Sift Snippet");var n=window._sift=window._sift||[];n.push(["_setAccount",o]),n.push(["_setSessionId",e]),n.push(["_trackPageview"]);var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.siftscience.com/s.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)},OpenPay.deviceData=n,OpenPay.getBeaconKey=i,OpenPay.deviceDataSC=r;var s={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=s),s.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,o,n,r,i,a=this._tables[0][4],c=this._tables[1],h=t.length,l=1;if(4!==h&&6!==h&&8!==h)throw new s.exception.invalid("invalid aes key size");for(this._key=[r=t.slice(0),i=[]],e=h;4*h+28>e;e++)n=r[e-1],(e%h===0||8===h&&e%h===4)&&(n=a[n>>>24]<<24^a[n>>16&255]<<16^a[n>>8&255]<<8^a[255&n],e%h===0&&(n=n<<8^n>>>24^l<<24,l=l<<1^283*(l>>7))),r[e]=r[e-h]^n;for(o=0;e;o++,e--)n=r[3&o?e:e-4],4>=e||4>o?i[o]=n:i[o]=c[0][a[n>>>24]]^c[1][a[n>>16&255]]^c[2][a[n>>8&255]]^c[3][a[255&n]]},s.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t,e,o,n,r,i,s,a,c,h=this._tables[0],l=this._tables[1],d=h[4],u=l[4],p=[],_=[];for(t=0;256>t;t++)_[(p[t]=t<<1^283*(t>>7))^t]=t;for(e=o=0;!d[e];e^=n||1,o=_[o]||1)for(s=o^o<<1^o<<2^o<<3^o<<4,s=s>>8^255&s^99,d[e]=s,u[s]=e,i=p[r=p[n=p[e]]],c=16843009*i^65537*r^257*n^16843008*e,a=257*p[s]^16843008*s,t=0;4>t;t++)h[t][e]=a=a<<24^a>>>8,l[t][s]=c=c<<24^c>>>8;for(t=0;5>t;t++)h[t]=h[t].slice(0),l[t]=l[t].slice(0)},_crypt:function(t,e){if(4!==t.length)throw new s.exception.invalid("invalid aes block size");var o,n,r,i,a=this._key[e],c=t[0]^a[0],h=t[e?3:1]^a[1],l=t[2]^a[2],d=t[e?1:3]^a[3],u=a.length/4-2,p=4,_=[0,0,0,0],f=this._tables[e],y=f[0],m=f[1],g=f[2],v=f[3],b=f[4];for(i=0;u>i;i++)o=y[c>>>24]^m[h>>16&255]^g[l>>8&255]^v[255&d]^a[p],n=y[h>>>24]^m[l>>16&255]^g[d>>8&255]^v[255&c]^a[p+1],r=y[l>>>24]^m[d>>16&255]^g[c>>8&255]^v[255&h]^a[p+2],d=y[d>>>24]^m[c>>16&255]^g[h>>8&255]^v[255&l]^a[p+3],p+=4,c=o,h=n,l=r;for(i=0;4>i;i++)_[e?3&-i:i]=b[c>>>24]<<24^b[h>>16&255]<<16^b[l>>8&255]<<8^b[255&d]^a[p++],o=c,c=h,h=l,l=d,d=o;return _}},s.bitArray={bitSlice:function(t,e,o){return t=s.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===o?t:s.bitArray.clamp(t,o-e)},extract:function(t,e,o){var n,r=Math.floor(-e-o&31);return n=-32&(e+o-1^e)?t[e/32|0]<<32-r^t[e/32+1|0]>>>r:t[e/32|0]>>>r,n&(1<<o)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var o=t[t.length-1],n=s.bitArray.getPartial(o);return 32===n?t.concat(e):s.bitArray._shiftRight(e,n,0|o,t.slice(0,t.length-1))},bitLength:function(t){var e,o=t.length;return 0===o?0:(e=t[o-1],32*(o-1)+s.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var o=t.length;return e=31&e,o>0&&e&&(t[o-1]=s.bitArray.partial(e,t[o-1]&2147483648>>e-1,1)),t},partial:function(t,e,o){return 32===t?e:(o?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(s.bitArray.bitLength(t)!==s.bitArray.bitLength(e))return!1;var o,n=0;for(o=0;o<t.length;o++)n|=t[o]^e[o];return 0===n},_shiftRight:function(t,e,o,n){var r,i,a=0;for(void 0===n&&(n=[]);e>=32;e-=32)n.push(o),o=0;if(0===e)return n.concat(t);for(r=0;r<t.length;r++)n.push(o|t[r]>>>e),o=t[r]<<32-e;return a=t.length?t[t.length-1]:0,i=s.bitArray.getPartial(a),n.push(s.bitArray.partial(e+i&31,e+i>32?o:n.pop(),1)),n},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},s.codec.utf8String={fromBits:function(t){var e,o,n="",r=s.bitArray.bitLength(t);for(e=0;r/8>e;e++)0===(3&e)&&(o=t[e/4]),n+=String.fromCharCode(o>>>24),o<<=8;return decodeURIComponent(escape(n))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,o=[],n=0;for(e=0;e<t.length;e++)n=n<<8|t.charCodeAt(e),3===(3&e)&&(o.push(n),n=0);return 3&e&&o.push(s.bitArray.partial(8*(3&e),n)),o}},s.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,o){var n,r="",i=0,a=s.codec.base64._chars,c=0,h=s.bitArray.bitLength(t);for(o&&(a=a.substr(0,62)+"-_"),n=0;6*r.length<h;)r+=a.charAt((c^t[n]>>>i)>>>26),6>i?(c=t[n]<<6-i,i+=26,n++):(c<<=6,i-=6);for(;3&r.length&&!e;)r+="=";return r},toBits:function(t,e){t=t.replace(/\s|=/g,"");var o,n,r=[],i=0,a=s.codec.base64._chars,c=0;for(e&&(a=a.substr(0,62)+"-_"),o=0;o<t.length;o++){if(n=a.indexOf(t.charAt(o)),0>n)throw new s.exception.invalid("this isn't base64!");i>26?(i-=26,r.push(c^n>>>i),c=n<<32-i):(i+=6,c^=n<<32-i)}return 56&i&&r.push(s.bitArray.partial(56&i,c,1)),r}},s.codec.base64url={fromBits:function(t){return s.codec.base64.fromBits(t,1,1)},toBits:function(t){return s.codec.base64.toBits(t,1)}},s.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},s.hash.sha256.hash=function(t){return(new s.hash.sha256).update(t).finalize()},s.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=s.codec.utf8String.toBits(t));var e,o=this._buffer=s.bitArray.concat(this._buffer,t),n=this._length,r=this._length=n+s.bitArray.bitLength(t);for(e=512+n&-512;r>=e;e+=512)this._block(o.splice(0,16));return this},finalize:function(){var t,e=this._buffer,o=this._h;for(e=s.bitArray.concat(e,[s.bitArray.partial(1,1)]),t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),o},_init:[],_key:[],_precompute:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,o=0,n=2;t:for(;64>o;n++){for(e=2;n>=e*e;e++)if(n%e===0)continue t;8>o&&(this._init[o]=t(Math.pow(n,.5))),this._key[o]=t(Math.pow(n,1/3)),o++}},_block:function(t){var e,o,n,r,i=t.slice(0),s=this._h,a=this._key,c=s[0],h=s[1],l=s[2],d=s[3],u=s[4],p=s[5],_=s[6],f=s[7];for(e=0;64>e;e++)16>e?o=i[e]:(n=i[e+1&15],r=i[e+14&15],o=i[15&e]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+i[15&e]+i[e+9&15]|0),o=o+f+(u>>>6^u>>>11^u>>>25^u<<26^u<<21^u<<7)+(_^u&(p^_))+a[e],f=_,_=p,p=u,u=d+o|0,d=l,l=h,h=c,c=o+(h&l^d&(h^l))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0;s[0]=s[0]+c|0,s[1]=s[1]+h|0,s[2]=s[2]+l|0,s[3]=s[3]+d|0,s[4]=s[4]+u|0,s[5]=s[5]+p|0,s[6]=s[6]+_|0,s[7]=s[7]+f|0}},s.prng=function(t){this._pools=[new s.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=t,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80},s.prng.prototype={randomWords:function(t,e){var o,n,r=[],i=this.isReady(e);if(i===this._NOT_READY)throw new s.exception.notReady("generator isn't seeded");for(i&this._REQUIRES_RESEED&&this._reseedFromPools(!(i&this._READY)),o=0;t>o;o+=4)(o+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),n=this._gen4words(),r.push(n[0],n[1],n[2],n[3]);return this._gate(),r.slice(0,t)},setDefaultParanoia:function(t,e){if(0===t&&"Setting paranoia=0 will ruin your security; use it only for testing"!==e)throw"Setting paranoia=0 will ruin your security; use it only for testing";this._defaultParanoia=t},addEntropy:function(t,e,o){o=o||"user";var n,r,i,a,c=(new Date).valueOf(),h=this._robins[o],l=this.isReady(),d=0;switch(n=this._collectorIds[o],void 0===n&&(n=this._collectorIds[o]=this._collectorIdNext++),void 0===h&&(h=this._robins[o]=0),this._robins[o]=(this._robins[o]+1)%this._pools.length,typeof t){case"number":void 0===e&&(e=1),this._pools[h].update([n,this._eventId++,1,e,c,1,0|t]);break;case"object":if(a=Object.prototype.toString.call(t),"[object Uint32Array]"===a){for(i=[],r=0;r<t.length;r++)i.push(t[r]);t=i}else for("[object Array]"!==a&&(d=1),r=0;r<t.length&&!d;r++)"number"!=typeof t[r]&&(d=1);if(!d){if(void 0===e)for(e=0,r=0;r<t.length;r++)for(i=t[r];i>0;)e++,i>>>=1;this._pools[h].update([n,this._eventId++,2,e,c,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this._pools[h].update([n,this._eventId++,3,e,c,t.length]),this._pools[h].update(t);break;default:d=1}if(d)throw new s.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[h]+=e,this._poolStrength+=e,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(t){var e=this._PARANOIA_LEVELS[void 0!==t?t:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(t){var e=this._PARANOIA_LEVELS[t?t:this._defaultParanoia];return this._strength>=e?1:this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1);else{if(!document.attachEvent)throw new s.exception.bug("can't attach event");document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(t,e){this._callbacks[t][this._callbackI++]=e},removeEventListener:function(t,e){var o,n,r=this._callbacks[t],i=[];for(n in r)r.hasOwnProperty(n)&&r[n]===e&&i.push(n);for(o=0;o<i.length;o++)n=i[o],delete r[n]},_bind:function(t){var e=this;return function(){t.apply(e,arguments)}},_gen4words:function(){for(var t=0;4>t&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new s.cipher.aes(this._key)},_reseed:function(t){this._key=s.hash.sha256.hash(this._key.concat(t)),this._cipher=new s.cipher.aes(this._key);for(var e=0;4>e&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(t){var e,o=[],n=0;for(this._nextReseed=o[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,e=0;16>e;e++)o.push(4294967296*Math.random()|0);for(e=0;e<this._pools.length&&(o=o.concat(this._pools[e].finalize()),n+=this._poolEntropy[e],this._poolEntropy[e]=0,t||!(this._reseedCount&1<<e));e++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new s.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=n,n>this._strength&&(this._strength=n),this._reseedCount++,this._reseed(o)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(t){var e=t.x||t.clientX||t.offsetX||0,o=t.y||t.clientY||t.offsetY||0;s.random.addEntropy([e,o],2,"mouse"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(t){window&&window.performance&&"function"==typeof window.performance.now?s.random.addEntropy(window.performance.now(),t,"loadtime"):s.random.addEntropy((new Date).valueOf(),t,"loadtime")},_accelerometerCollector:function(t){var e=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z;if(window.orientation){var o=window.orientation;"number"==typeof o&&s.random.addEntropy(o,1,"accelerometer")}e&&s.random.addEntropy(e,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(t,e){var o,n=s.random._callbacks[t],r=[];for(o in n)n.hasOwnProperty(o)&&r.push(n[o]);for(o=0;o<r.length;o++)r[o](e)}},s.random=new s.prng(6),function(){try{var t,e,o;if("undefined"!=typeof module&&module.exports&&(e=require("crypto"))&&e.randomBytes)t=e.randomBytes(128),t=new Uint32Array(new Uint8Array(t).buffer),s.random.addEntropy(t,1024,"crypto.randomBytes");else if(window&&Uint32Array){if(o=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(o);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)return;window.msCrypto.getRandomValues(o)}s.random.addEntropy(o,1024,"crypto.getRandomValues")}}catch(n){console.log("There was an error collecting entropy from the browser:"),console.log(n)}}()}).call(this);